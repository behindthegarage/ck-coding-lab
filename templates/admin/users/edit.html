{% extends 'admin/admin_base.html' %}

{% block title %}Edit User{% endblock %}
{% block header %}Edit User: {{ user.username }}</h2>{% endblock %}

{% block content %}
<form method="POST" action="{{ url_for('admin.admin_update_user', user_id=user.id) }}" class="admin-form">
    <div class="form-group">
        <label>Username</label>
        <input type="text" value="{{ user.username }}" disabled 
               style="background: #252542; color: #888;">
        <small style="color: #666;">Username cannot be changed</small>
    </div>
    
    <div class="form-group">
        <label for="pin">New PIN (leave blank to keep current)</label>
        <input type="password" id="pin" name="pin" 
               minlength="4" maxlength="4" pattern="\d{4}"
               placeholder="****">
        <small style="color: #666;">Enter new 4-digit PIN to reset, or leave blank</small>
    </div>
    
    <div class="form-group">
        <label for="role">Role</label>
        <select id="role" name="role" required {% if user.id == g.current_user.id %}disabled style="background: #252542; color: #888;"{% endif %}">
            <option value="kid" {% if user.role == 'kid' %}selected{% endif %}">Kid (Student)</option>
            <option value="admin" {% if user.role == 'admin' %}selected{% endif %}">Admin (Administrator)</option>
        </select>
        {% if user.id == g.current_user.id %}
        <small style="color: #666;">You cannot change your own role</small>
        <input type="hidden" name="role" value="{{ user.role }}">
        {% endif %}
    </div>
    
    <div class="form-group">
        <label>
            <input type="checkbox" name="is_active" {% if user.is_active %}checked{% endif %} 
                   {% if user.id == g.current_user.id %}disabled{% endif %}"
            >
            Account Active
        </label>
        {% if user.id == g.current_user.id %}
        <input type="hidden" name="is_active" value="on">
        <small style="color: #666; display: block; margin-top: 0.5rem;">You cannot deactivate your own account</small>
        {% endif %}
    </div>
    
    <div class="form-group">
        <label>User Stats</label>
        <div style="background: #0f0f1a; padding: 1rem; border-radius: 4px; border: 1px solid #333;">
            <p style="margin: 0.25rem 0; color: #888;"><strong style="color: #ccc;">Created:\u003c/strong> {{ user.created_at[:16].replace('T', ' ') if user.created_at else 'Unknown' }}</p>
            <p style="margin: 0.25rem 0; color: #888;"><strong style="color: #ccc;">Last Login:\u003c/strong> {{ user.last_login[:16].replace('T', ' ') if user.last_login else 'Never' }}</p>
            <p style="margin: 0.25rem 0; color: #888;"><strong style="color: #ccc;">Projects:\u003c/strong> {{ user.project_count or 0 }}</p>
        </div>
    </div>
    
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save Changes</button>
        <a href="{{ url_for('admin.admin_users') }}" class="btn btn-secondary">Cancel</a>
    </div>
</form>
{% endblock %}
